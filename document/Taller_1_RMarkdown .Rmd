---
title: "Problem Set 1 RMarkdown"
author: "Irina Vélez - Lucía Fillippo - Daniel Casas - Miguel Victoria"
date: "2023-06-21"
output: word_document
---
```{r setup, include=FALSE}
# install pacman
if(!require(pacman)) install.packages("pacman") ; require(pacman)

## Automatiza cargue de paquetes
require(pacman)
p_load(rio, 
       tidyverse, 
       skimr,
       caret,
       rstudioapi,
       rvest) 
```

```{r path, include=FALSE}
rm(list=ls())
getwd()
path_sript <- rstudioapi::getActiveDocumentContext()$path
path_folder <- dirname(path_sript)
setwd(path_folder)
```

```{r Import_data, eval=FALSE, include=FALSE}
### Loading data  
data_url = "https://ignaciomsarmiento.github.io/GEIH2018_sample/pages/geih_"

# Loop
db_list <- lapply(1:10, function(i) {
  url <- paste0(data_url, "page_", i, ".html")
  page <- read_html(url) 
  tabla <- page %>% html_table
  db_geih <- data.frame(tabla)
})

db_geih <- do.call(rbind,db_list) # Concatenate the tables in a dataframe
view(db_geih)
```

```{r Transforming_data, eval=FALSE, include=FALSE}
##Filtering the data to those over 18 and employed (ocu=1)
# Details of the variable age 
summary(db_geih$age)
sum(is.na(db_geih$age)) # Checking for missing values
sum(is.na(db_geih$ocu))

db_geih_filtered <- db_geih[db_geih$age > 18 & db_geih$ocu == 1, ]
save(db_geih_filtered, file = "/Users/irina/Documents/Repositorios/PS1_Predicting_income/stores/data.Rdata")

## Dealing with missing values
# Count missing values for each column and sorting
missing_counts <- sapply(db_geih_filtered, function(x) sum(is.na(x)))
sorted_missing <- sort(missing_counts, decreasing = TRUE)
top_missing <- head(sorted_missing, 30)
top_missing

# Deleting the top missing variables and all variables that start with cclasnr
delete_var <- c("p550", "p7310", "p7350", "p7422", "p7422s1", "p7472", "p7472s1", "ina", "imdi", "imdies", "y_gananciaNetaAgro_m", "iof3ies", "y_accidentes_m", "p6585s4a2", "y_subEducativo_m", "isaes", "iof2es", "dominio", "clase")
delete_var2 <- grep("^cclasnr", names(db_geih_filtered), value = TRUE)
delete_t <- c(delete_var, delete_var2)

geih_filtered <- db_geih_filtered %>%
  select(-one_of(delete_t))

## Dealing with 0 wages

# Verification of the min and max value of the main resultant variables, and their missing values
summary(geih_filtered$p6500)           # Monthly labor income. DANE Variable
summary(geih_filtered$y_ingLab_m)      # labor income salaried nominal monthly
summary(geih_filtered$y_ingLab_m_ha)   # labor income salaried nominal hourly
summary(geih_filtered$y_salary_m)      # salary - nominal monthly
summary(geih_filtered$y_salary_m_hu)   # salary - real hourly (usual)

missing_income <- sum(is.na(geih_filtered$y_ingLab_m_ha))
obs <- nrow(geih_filtered)

# The 40.32% of the observations for the main resultant variables have missing values
missing_perc = (missing_income/obs)*100
missing_perc

missing_values <- is.na(geih_filtered$y_salary_m_hu)
missing_data <- geih_filtered[missing_values, c("estrato1", "maxEducLevel")]

missing_by_estrato <- table(missing_data$estrato1)
missing_by_educ <- table(missing_data$maxEducLevel)


missing_by_estrato <- sort(missing_by_estrato, decreasing = TRUE)
missing_by_educ <- sort(missing_by_educ, decreasing = TRUE)

missing_by_estrato_p <- missing_by_estrato / sum(missing_by_estrato) * 100
missing_by_educ_p <- missing_by_educ / sum(missing_by_educ) * 100

missing_by_estrato_p
missing_by_educ_p

# Data frame with the results
results <- data.frame(estrato = names(missing_by_estrato_p),
                      educacion = names(missing_by_educ_p),
                      p_missing_estrato = missing_by_estrato_p,
                      p_missing_educacion = missing_by_educ_p)

knitr::kable(results, caption = "Missing Values by Estrato and Educación")

geih_filtered <- geih_filtered[complete.cases(geih_filtered$y_salary_m_hu), ]
save(geih_filtered, file = "/Users/irina/Documents/Repositorios/PS1_Predicting_income/stores/data.Rdata")
```

```{r Import_DB, include=FALSE}
load("../stores/data.Rdata")
```

# Taller 1

El presente informe presenta la solución al Problem Set 1 de la clase Big Data & Machine Learning, en donde se aplicaron diversos conceptos y herramientas para la predicción de modelos, el manejo de bases de datos grandes, entre otros. El repositorio GitHub se encuentra este documento y el código R, en donde se generaron todos los resultados. Este repositorio se encuentra en el siguiente link: (link del Github con el código)

## 1. Introducción

Conocer el valor de los ingresos de las personas es fundamental para el pago de impuestos y para identificar a los hogares que requieren apoyos sociales; no obstante, en algunas ocasiones estos valores no se conocen al no ser reportados, de manera que poder determinar su valor se convierte en un gran insumo para el desarrollo de políticas tributarias y sociales. Con objeto de lo anterior, el objetivo principal de este documento es construir un modelo predictivo de los salarios por hora de los individuos, a partir del siguiente modelo:

$$
w=f(X)+u
$$

donde w representa el salario por hora y X es una matriz de potenciales variables que explican el salario. Para la creación de este modelo se utilizarán datos de la Gran Encuesta Integrada de Hogares – GEIH del año 2018. 

Para importar los datos, es importante conocer qué tipo de página web contiene la información, en este caso, la página web que contiene las bases de datos es dinámica, por lo que es pertinente identificar el link principal del cual se realizará la extracción de la información; además, se apliará un código en bucle para que la extracción de la informacíon sea más eficiente.Por último, como fue indicado, se realiza un primer filtro para tener en cuenta únicamente los individuos mayores de 18 años.


```{r limpiar_base, include=FALSE}
# Filtro adultos
Datos_18<- datos %>%  filter(age>18)
summary(Datos_18$age)

# Primera columna


# Columna Bogota

#



# Filtro Omitir NA




```


### GEIH Descr_iption
```{r GEIH}

summary(Datos_18$mes)

```

### Process of acquiring the data



### Data cleaning process

```{r Transformation, include=FALSE}
# 1. Only on employed individuals older than 18 years old
# 2. Observations with missing data or 0 wages

```


### Descriptive Analysis

```{r Descriptive}


 

## Tables

## Deeper Analysis

## Justification for the data choices


```

## Age-wage profile

A great deal of evidence in Labor economics suggests that the typical worker’s age-wage profile has a predictable path: “Wages tend to be low when the worker is young; they rise as the worker ages, peaking at about age 50; and the wage rate tends to remain stable or decline slightly after age 50”

###  Estimate the Age-wage profile
$$
Log(w)=/beta_1+/beta_2Age+/beta_3Age^2+u
$$





This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


# Notas
Sustentar todas las medidas que salgan en las regresiones
Exportar salidas de regresión con stargazer